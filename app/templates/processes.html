{% extends "base.html" %} {% block head %}
<title>PSUTIL-DASHBOARD | Processes</title>
<link
  rel="stylesheet"
  type="text/css"
  href="https://cdn.datatables.net/v/bs5/dt-1.13.1/datatables.min.css"
/>
<style>
  /* Custom DataTables styling to match our theme */
  .dataTables_wrapper .dataTables_length,
  .dataTables_wrapper .dataTables_filter,
  .dataTables_wrapper .dataTables_info,
  .dataTables_wrapper .dataTables_processing,
  .dataTables_wrapper .dataTables_paginate {
    color: var(--text-secondary);
    margin: 1rem 0;
  }

  .dataTables_wrapper .dataTables_paginate .paginate_button {
    color: var(--text-secondary) !important;
    border-radius: 5px;
    margin: 0 3px;
  }

  .dataTables_wrapper .dataTables_paginate .paginate_button.current,
  .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
    background: var(--primary-color) !important;
    color: white !important;
    border: none;
  }

  .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
    background: var(--card-bg) !important;
    color: var(--text-primary) !important;
    border: 1px solid var(--primary-color);
  }

  .dataTables_wrapper .dataTables_filter input {
    background-color: var(--card-bg);
    color: var(--text-primary);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    padding: 0.375rem 0.75rem;
  }

  .dataTables_wrapper .dataTables_length select {
    background-color: var(--card-bg);
    color: var(--text-primary);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    padding: 0.375rem 0.75rem;
  }

  /* Process status indicators */
  .status-indicator {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 8px;
  }

  .status-running {
    background-color: var(--success);
  }

  .status-sleeping {
    background-color: var(--info);
  }

  .status-stopped {
    background-color: var(--warning);
  }

  .status-zombie {
    background-color: var(--danger);
  }

  /* Process link styling */
  .process-link {
    color: var(--primary-color);
    text-decoration: none;
    transition: all 0.2s;
  }

  .process-link:hover {
    color: var(--text-primary);
    text-decoration: underline;
  }

  /* Resource usage bars */
  .resource-bar {
    height: 6px;
    border-radius: 3px;
    background-color: rgba(255, 255, 255, 0.1);
    overflow: hidden;
    margin-top: 5px;
  }

  .resource-bar-fill {
    height: 100%;
    background: linear-gradient(
      90deg,
      var(--primary-color),
      var(--secondary-color)
    );
  }

  .resource-warning .resource-bar-fill {
    background: linear-gradient(90deg, var(--warning), var(--danger));
  }
</style>
{% endblock %} {% block pagetitle %}
<div class="text-center w-100">
  <h3 class="text-white h3">Processes</h3>
  <p class="text-small text-muted">
    {% if context.platform_info['os_name'] != 'unknown' %}
    <i class="fa-brands fa-{{context.platform_info['os_name']}}"></i>
    {% else %}
    <i class="fa-brands fa-question"></i>
    {% endif %}
    <span class="badge bg-dark">
      Hostname: {{ context.platform_info['node_name'] }}
    </span>
    <span class="badge bg-dark">
      OS: {% if context.platform_info['os_name'] == 'apple' %} macOS {% else %}
      {{ context.platform_info['os_name']|title }} {% endif %}
    </span>
    <span class="badge bg-dark">
      System: {{ context.platform_info['system_name'] }} v{{
      context.platform_info['release_version'] }}
    </span>
    <span class="badge bg-dark">
      Architecture: {{ context.platform_info['architecture'] }}
    </span>
    <span class="badge bg-dark">
      Up Time: {{ context.platform_info['boot_time'] }}
    </span>
  </p>
</div>
{% endblock %} {% block body %}
<!-- Main Contents -->
<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div>
        <i class="fa-solid fa-microchip me-2 text-primary"></i>
        <span class="fw-bold">Running Processes</span>
      </div>
      <div>
        <span class="badge bg-primary" id="process-count">
          {{ context.process_list|length }} Processes
        </span>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table id="all-processes-table" class="table table-dark table-hover">
          <thead>
            <tr>
              <th>PID</th>
              <th>Name</th>
              <th>User</th>
              <th>Status</th>
              <th>Created</th>
              <th>Memory (%)</th>
              <th>CPU (%)</th>
            </tr>
          </thead>
          <tbody>
            {% for processes in context.process_list.values() %}
            <tr>
              <td>
                <a
                  class="process-link"
                  href="{{ url_for('processes') }}/{{processes.pid}}"
                  >{{processes.pid}}</a
                >
              </td>
              <td>{{processes.name}}</td>
              <td>{{processes.username}}</td>
              <td>
                {% if processes.status == 'running' %}
                <span class="status-indicator status-running"></span>
                {% elif processes.status == 'sleeping' %}
                <span class="status-indicator status-sleeping"></span>
                {% elif processes.status == 'stopped' %}
                <span class="status-indicator status-stopped"></span>
                {% elif processes.status == 'zombie' %}
                <span class="status-indicator status-zombie"></span>
                {% endif %} {{processes.status}}
              </td>
              <td>{{processes.create_time.strftime('%d-%m-%y %H:%M:%S')}}</td>
              <td>
                {% if processes.memory_percent != None %}
                <div>{{processes.memory_percent|round(1)}}%</div>
                <div
                  class="resource-bar {% if processes.memory_percent > 50 %}resource-warning{% endif %}"
                >
                  <div
                    class="resource-bar-fill"
                    style="width: {{processes.memory_percent|round(1)}}%"
                  ></div>
                </div>
                {% else %}
                <div>N/A</div>
                {% endif %}
              </td>
              <td>
                {% if processes.cpu_percent != None %}
                <div>{{processes.cpu_percent|round(1)}}%</div>
                <div
                  class="resource-bar {% if processes.cpu_percent > 50 %}resource-warning{% endif %}"
                >
                  <div
                    class="resource-bar-fill"
                    style="width: {{processes.cpu_percent|round(1)}}%"
                  ></div>
                </div>
                {% else %}
                <div>N/A</div>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</main>
{% endblock %} {% block script %}
<script
  type="text/javascript"
  src="https://code.jquery.com/jquery-3.6.0.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdn.datatables.net/v/bs5/dt-1.13.1/datatables.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"
></script>
<script>
  $(document).ready(function () {
    // Initialize DataTables with modern options
    const table = $("#all-processes-table").DataTable({
      order: [[6, "desc"]], // Sort by CPU usage by default
      pageLength: 15,
      lengthMenu: [
        [10, 15, 25, 50, -1],
        [10, 15, 25, 50, "All"],
      ],
      responsive: true,
      dom: '<"top d-flex justify-content-between"lf>rt<"bottom d-flex justify-content-between"ip>',
      language: {
        search: "_INPUT_",
        searchPlaceholder: "Search processes...",
        lengthMenu: "Show _MENU_ processes",
        info: "Showing _START_ to _END_ of _TOTAL_ processes",
        paginate: {
          first: '<i class="fa fa-angle-double-left"></i>',
          last: '<i class="fa fa-angle-double-right"></i>',
          previous: '<i class="fa fa-angle-left"></i>',
          next: '<i class="fa fa-angle-right"></i>',
        },
      },
    });

    // Add stats to badge
    $("#process-count").text(`${table.rows().count()} Processes`);

    // Add refresh functionality - updating every 30 seconds
    setInterval(function () {
      if (autoRefresh) {
        // This refers to the autoRefresh variable from base.html
        location.reload();
      }
    }, 30000);
  });
</script>
{% endblock %}
